@page "/licitacao"
@inject HttpClient Http
@inject NavigationManager NavigationManager;
@inject IPinturaDAO _pinturas
@inject ILicitacaoDAO _licitacoes
@inject ILeilaoDAO _leilao
@inject IUtilizadorDAO _utilizador
@inject AppState AppState
@using DataLayer


<PageTitle>BelasArtes</PageTitle>

<!-- Fundo -->
<div style="width: 100%; height: 90%; position: absolute; background: white"></div>
<div style="width: 100%; height: 120%; left: 0%; top: 15%; position: absolute; background: #D9D9D9;)"></div>


<!-- Cabecalho -->
<img style="width: 5; height: 14%; left: 0%; top: 0.5%; position: absolute" src="logo.png" />
<div style="width: 30%; height: 20%; left: 2%; top: 4%; position: absolute; text-align: center; color: black; font-size: 200%; font-family: Inter; font-weight: 500; word-wrap: break-word">Leilões Belas Artes</div>

<button onclick="window.location.href='/'">
<div style="width: 10%; height: 10%; left: 89.5%; top: 5%; position: absolute; text-align: center; color: black; font-size: 175%; font-family: Inter; font-weight: 100; word-wrap: break-word">LogOut</div>
</button>
<div style="width: 0%; height: 8%; left: 89.5%; top: 3.5%; position: absolute; border: 1px rgb(0, 0, 0) solid"></div>

<button onclick="window.location.href='/leiloesAgendados'">
<div style="width: 20%; height: 10%; left: 71%; top: 5%; position: absolute; text-align: center; color: black; font-size: 175%; 
font-family: Inter; font-weight: 100; word-wrap: break-word">Leilões Agendados</div>
</button>
<div style="width: 0%; height: 8%; left: 72.5%; top: 3.5%; position: absolute; border: 1px rgb(0, 0, 0) solid"></div>

<button onclick="window.location.href='/leiloesAtivos'">
<div style="width: 20%; height: 10%; left: 54%; top: 5%; position: absolute; text-align: center; color: black; font-size: 175%; font-family: Inter; font-weight: 100; word-wrap: break-word">Leilões Ativos</div>
</button>
<div style="width: 0%; height: 8%; left: 55.5%; top: 3.5%; position: absolute; border: 1px rgb(0, 0, 0) solid"></div>

<button onclick="window.location.href='/profile'">
<div style="width: 10%; height: 10%; left: 46%; top: 5%; position: absolute; text-align: center; color: black; font-size: 175%; font-family: Inter; font-weight: 100; word-wrap: break-word">Perfil</div>
</button>
<div style="width: 0%; height: 8%; left: 89.5%; top: 3.5%; position: absolute; border: 1px rgb(0, 0, 0) solid"></div>

<!--Caixa Esquerda-->
@if (!string.IsNullOrEmpty(pintura?.Foto)){
    <img style="width: 42.5%; height: 87.5%; left: 5%; top: 35%; position: absolute; background: white; border-radius: 59px; border: 4px black solid" src="@pintura.Foto">
}else{
    <div style="width: 100%; height: 100%;left: -25%; text-align: center; color: red; font-size: 20px; font-family: Inter; font-weight: 500; position: absolute; top: 50%;">Foto não disponível</div>
}

<div style="width: 42.5%; height: 87.5% ; left : 5%; top: 22.5%; position: absolute; text-align: center; color: black; font-size: 
64px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        @($"{pintura.Nome}")
    }else{
        <span></span>
    }
</div>


<!--Caixa Direita-->
<div style="width: 42.5%; height: 87.5%; left: 50%; top: 35%; position: absolute; background: #D9D9D9; border-radius: 59px; border: 4px black solid"></div>
<div style="width: 42.5%; height: 87.5%; left: 50%; top: 25%; position: absolute; text-align: center; color: black; font-size: 45px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @{
        string tempoRestanteFormatado = "";

        if (leilao != null){
            TimeSpan tempoRestante = leilao.DataFim - DateTime.Now;
            tempoRestanteFormatado = $"Termina em: {tempoRestante.Days}D {tempoRestante.Hours}H {tempoRestante.Minutes}M {tempoRestante.Seconds}S";
        }else{
            tempoRestanteFormatado = "00D:00H:00M:00S";
        }
    }

    @tempoRestanteFormatado
</div>



<div style="width: 42.5%; height: 87.5%; left: 40%; top: 39.5%; position: absolute; text-align: center; color: black; font-size: 27px; font-family: Inter; font-weight: 167; word-wrap: break-word">Licitação atual:</div>
<div style="width: 42.5%; height: 87.5%; left: 40%; top: 44.5%; position: absolute; text-align: center; color: black; font-size: 55px; font-family: Inter; font-weight: 300; word-wrap: break-word">
    @if (licitacao != null){
        @($"{licitacao.Valor} €")
    }else{
        <span>0€</span>
    }</div>

<div style="width: 42.5%; height: 87.5%; left: 58.5%; top: 39.5%; position: absolute; text-align: center; color: black; font-size: 
27px; font-family: Inter; font-weight: 167; word-wrap: break-word">Efetuada por:</div>
<div style="width: 42.5%; height: 87.5%; left: 58.5%; top: 47%; position: absolute; text-align: center; color: black; font-size: 28px; font-family: Inter; font-weight: 400; word-wrap: break-word">
    @if (utilizador != null){
        @($"{utilizador.Nome}")
    }else{
        <span>Não existe licitador atual.</span>
    }
</div>

<div style="width: 20%; height: 15%; left: 61.5%; top: 65%; position: absolute; background: white"></div>
<div style="width: 20%; height: 15%; left: 54.5%; top: 65%; position: absolute; text-align: center; color: black; font-size: 70px; 
font-family: Inter; font-weight: 167; word-wrap: break-word">€</div>
<input type="text" @bind="ValorLicitacao" placeholder="Valor da licitação..." style="width: 14%; height: 15%; left: 66.5%; top: 65%; position: absolute; background: #ffffff; padding: 5px; border: none; font-size: 20px; font-family: Inter; font-weight: 167; box-sizing: border-box; outline:none;">
<div style="width: 20%; height: 15%; left: 58.5%; top: 80%; position: absolute; text-align: center; color: black; font-size: 23px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @if (licitacao != null && leilao != null){
            @($"Valor mínimo: {licitacao.Valor * 1.05}€")
        }else if(licitacao==null && leilao !=null){
            @($"Valor mínimo:{leilao.PrecoInicial}€") 
        }else{
            @($"") 
        }
</div>

<div style="width: 30%; height: 10%; left: 58.5%; top: 98%; position: absolute; text-align: center; color: black; font-size: 24px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura!= null){
        @($"{pintura.Peso*2}€ para Portugal, {pintura.Peso*4}€ envio internacional")
    }else{
        <span></span>
    }
</div>
<img style="width: 7.5%; height: 15%; left: 52.5%; top: 93%; position: absolute" src="truckLogo.png" />


@code {
    private int? ValorLicitacao {get;set;}
    private void ValidaDados(){
        if (ValorLicitacao==null) return;
        if(licitacao != null && leilao!=null){
            if (ValorLicitacao > licitacao.Valor * 1.05){
                DataLayer.Licitacao licitacao_nova = new DataLayer.Licitacao(null,
                ValorLicitacao,AppState.atual_user,DateTime.Now,AppState.atual_leilao);
                _licitacoes.PutLicitacao(licitacao_nova);
                NavigationManager.NavigateTo("/leiloesAtivos"); 
            } else {
                NavigationManager.NavigateTo("/licitacao"); 
            }
        }else if(licitacao == null && leilao!=null){
            if (ValorLicitacao > leilao.PrecoInicial ){
                DataLayer.Licitacao licitacao_nova = new DataLayer.Licitacao(null,
                ValorLicitacao,AppState.atual_user,DateTime.Now,AppState.atual_leilao);
                _licitacoes.PutLicitacao(licitacao_nova);
                NavigationManager.NavigateTo("/leiloesAtivos"); 
            }else{
                NavigationManager.NavigateTo("/licitacao"); 
            }
        }else{
            NavigationManager.NavigateTo("/licitacao");
        }
    }
}


<button @onclick="ValidaDados" style="width: 17.5%; height: 10%; left: 62.5%; top: 106.5%; position: absolute; background: black; border-radius: 59px; 
border: none; outline: none;">
    <span style="color: white; font-size: 250%; font-family: Inter;">Submeter</span>
</button>
<!--Fundo da pagina-->
<div style="width: 30%; height: 15%; left: 7.5%; top: 140%; position: absolute; color: black; font-size: 25px; font-family: 
Inter; font-weight: 400; word-wrap: break-word">Descrição:</div>
<div style="width: 30%; height: 15%; left: 7.5%; top: 145.5%; position: absolute; color: black; font-size: 20px; font-family: 
Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        @($"{pintura.Descricao}")
    }else{
        <span></span>
    }
</div>

<div style="width: 30%; height: 15%; left: 7.5%; top: 155%; position: absolute; color: black; font-size: 25px; font-family: Inter; font-weight: 400; word-wrap: break-word">Dimensão:</div>
<div style="width: 30%; height: 15%; left: 7.5%; top: 160.5%; position: absolute; color: black; font-size: 20px; font-family: 
Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        @($"A: {pintura.Altura}cm x L: {pintura.Largura}cm")
    }else{
        <span></span>
    }
</div>

<div style="width: 30%; height: 15%; left: 35%; top: 155%; position: absolute; color: black; font-size: 25px; font-family: 
Inter; font-weight: 400; word-wrap: break-word">Peso:</div>
<div style="width: 30%; height: 15%; left: 35%; top: 160.5%; position: absolute; color: black; font-size: 20px; font-family: 
Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        @($"{pintura.Peso}kg")
    }else{
        <span></span>
    }
</div>

<div style="width: 30%; height: 15%; left: 7.5%; top: 170%; position: absolute; color: black; font-size:25px; font-family: Inter; font-weight: 400; word-wrap: break-word">Autenticidade:</div>
<div style="width: 30%; height: 15%; left: 7.5%; top: 175.5%; position: absolute; color: black; font-size:20px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        <span>
            @if (pintura.Original != null){
                @if (pintura.Original == true){
                    @("Original")
                }else{
                    @("Replica")
                }
            }else{
                @("Nao especificado")
            }
        </span>
    }else{
        <span></span>
    }
</div>


<div style="width: 30%; height: 15%; left: 35%; top: 170%; position: absolute; color: black; font-size: 25px; font-family: 
Inter; font-weight: 400; word-wrap: break-word">Ano de criação:</div>
<div style="width: 30%; height: 15%; left: 35%; top: 175.5%; position: absolute; color: black; font-size: 20px; font-family: 
Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        @($"{pintura.AnoCriacao}")
    }else{
        <span></span>
    }
</div>

<div style="width: 30%; height: 15%; left: 7.5%; top: 185%; position: absolute; color: black; font-size: 25px; font-family: Inter; font-weight: 400; word-wrap: break-word">Movimento artístico:</div>
<div style="width: 30%; height: 15%; left: 7.5%; top: 190.5%; position: absolute; color: black; font-size: 20px; font-family: Inter; font-weight: 167; word-wrap: break-word">
    @if (pintura != null){
        <span>
        @if (pintura.CodMovimentoArtistico==1){
            @("Antiguidade Ocidental e Oriental")
        }else if (pintura.CodMovimentoArtistico==2){
            @("Idade Média")
        }else if (pintura.CodMovimentoArtistico==3){
            @("Renascentista e Barroco")
        }else if (pintura.CodMovimentoArtistico==4){
            @("Moderno")
        }else if (pintura.CodMovimentoArtistico==5){
            @("Contemporâne")
        }else{
             @("Outro")
        }
        </span>
    }else{
        <span></span>
    }
</div>

@code {
    private DataLayer.Licitacao licitacao { get; set; } = new DataLayer.Licitacao();
    private DataLayer.Pintura pintura { get; set; } = new Pintura();
    private DataLayer.Leilao leilao {get; set; } = new Leilao();
    private Datalayer.Utilizador utilizador {get;set;} = new Datalayer.Utilizador();

    protected override async Task OnInitializedAsync(){
        leilao = (await _leilao.GetLeilaoById(AppState.atual_leilao)).First();
        licitacao = (await _licitacoes.LicitacoesDoLeilaoOrdenadasPorValor(AppState.atual_leilao)).First();
        pintura = (await _pinturas.GetPinturaById(leilao.CodPintura)).First(); 
        if (licitacao.EmailLicitador!=null) utilizador = (await _utilizador.GetUtilizadorByEmail(licitacao.EmailLicitador)).First(); 
    }
}